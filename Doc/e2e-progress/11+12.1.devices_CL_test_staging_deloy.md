- ### ğŸ¯ Má»¥c tiÃªu bÆ°á»›c nÃ y
  
  - ÄÆ°a API (Go + Gin) Ä‘Ã£ build thÃ nh container image lÃªn má»™t mÃ´i trÆ°á»ng **staging**.
    
  - MÃ´i trÆ°á»ng staging cháº¡y cÃ¹ng Postgres, cÃ³ `.env` riÃªng (nhÆ° báº£n ACE Ä‘Ã£ cÃ³).
    
  - TrÆ°á»›c khi cháº¡y app, pháº£i **apply migrations** Ä‘á»ƒ DB staging khá»›p schema.
    
  - Sau Ä‘Ã³ kiá»ƒm tra `/healthz` vÃ  `/readiness` Ä‘áº£m báº£o API hoáº¡t Ä‘á»™ng.
    
  
  ### ğŸ› ï¸ CÃ´ng viá»‡c cá»¥ thá»ƒ
  
  1. **Build Docker image** tá»« `build/Dockerfile`.
    
  2. **Push image** lÃªn registry (GitHub Container Registry hoáº·c Docker Hub).
    
  3. **TrÃªn mÃ¡y staging**: táº¡o `.env` (copy ná»™i dung tÆ°Æ¡ng tá»± file `.env` hiá»‡n táº¡i nhÆ°ng chá»‰nh host/secret phÃ¹ há»£p).
    
  4. **Cháº¡y migrations** báº±ng `golang-migrate` container, dÃ¹ng biáº¿n `DATABASE_URL`.
    
  5. **Compose up** `api + db` (theo `docker-compose.staging.yml`).
    
  6. **Smoke test** báº±ng `curl /healthz` Ä‘á»ƒ cháº¯c app lÃªn OK.
    

## Cháº¡y láº¡i api vá»›i mÃ´i trÆ°á»ng staging

docker compose --env-file .\.env.staging up -d --force-recreate
 docker compose --env-file .\.env.staging up -d --force-recreate api

### B1: Láº¥y Ä‘Æ°á»ng dáº«n full kiá»ƒu Windows

`$migrationsPath = (Resolve-Path .\db\migrations).Path`

VÃ­ dá»¥: `$migrationsPath = "E:\VietAnh-6689\Projects\working_hours_maintenance_notification\db\migrations"`

---

### B2: Chuyá»ƒn thÃ nh path kiá»ƒu WSL/Unix (Docker hiá»ƒu)

Docker Desktop trÃªn Windows muá»‘n mount volume thÃ¬ dÃ¹ng `/host_mnt/e/...`

Ta convert:

`$drive = $migrationsPath.Substring(0,1).ToLower() # e $rest = $migrationsPath.Substring(2) # \VietAnh-6689\Projects... $unixPath = "/host_mnt/$drive/$($rest -replace '\\','/')"`

Káº¿t quáº£ vÃ­ dá»¥:  
`/host_mnt/e/VietAnh-6689/Projects/working_hours_maintenance_notification/db/migrations`

---

### B3: Cháº¡y migrate
```shell
docker run --rm `
  -v "${unixPath}:/migrations" `
  fdda4f6dca43 `
  -path=/migrations -database "$DBURL_HOST" up
```