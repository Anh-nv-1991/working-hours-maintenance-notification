- ### 🎯 Mục tiêu bước này
  
  - Đưa API (Go + Gin) đã build thành container image lên một môi trường **staging**.
    
  - Môi trường staging chạy cùng Postgres, có `.env` riêng (như bản ACE đã có).
    
  - Trước khi chạy app, phải **apply migrations** để DB staging khớp schema.
    
  - Sau đó kiểm tra `/healthz` và `/readiness` đảm bảo API hoạt động.
    
  
  ### 🛠️ Công việc cụ thể
  
  1. **Build Docker image** từ `build/Dockerfile`.
    
  2. **Push image** lên registry (GitHub Container Registry hoặc Docker Hub).
    
  3. **Trên máy staging**: tạo `.env` (copy nội dung tương tự file `.env` hiện tại nhưng chỉnh host/secret phù hợp).
    
  4. **Chạy migrations** bằng `golang-migrate` container, dùng biến `DATABASE_URL`.
    
  5. **Compose up** `api + db` (theo `docker-compose.staging.yml`).
    
  6. **Smoke test** bằng `curl /healthz` để chắc app lên OK.
    

## Chạy lại api với môi trường staging

docker compose --env-file .\.env.staging up -d --force-recreate
 docker compose --env-file .\.env.staging up -d --force-recreate api

### B1: Lấy đường dẫn full kiểu Windows

`$migrationsPath = (Resolve-Path .\db\migrations).Path`

Ví dụ: `$migrationsPath = "E:\VietAnh-6689\Projects\working_hours_maintenance_notification\db\migrations"`

---

### B2: Chuyển thành path kiểu WSL/Unix (Docker hiểu)

Docker Desktop trên Windows muốn mount volume thì dùng `/host_mnt/e/...`

Ta convert:

`$drive = $migrationsPath.Substring(0,1).ToLower() # e $rest = $migrationsPath.Substring(2) # \VietAnh-6689\Projects... $unixPath = "/host_mnt/$drive/$($rest -replace '\\','/')"`

Kết quả ví dụ:  
`/host_mnt/e/VietAnh-6689/Projects/working_hours_maintenance_notification/db/migrations`

---

### B3: Chạy migrate
```shell
docker run --rm `
  -v "${unixPath}:/migrations" `
  fdda4f6dca43 `
  -path=/migrations -database "$DBURL_HOST" up
```